appId: ${APP_ID}
jsEngine: graaljs
---
- runFlow: utils/launchTestAppClear.yml

# Open feedback widget
- tapOn: 'Feedback'

# Assert that all feedback form elements are visible
- extendedWaitUntil:
    visible:
      id: 'sentry-logo'
    timeout: 1_000
- assertVisible:
    id: 'form-title'
- assertVisible:
    id: 'name-label'
- assertVisible:
    id: 'name-input'
- assertVisible:
    id: 'email-label'
- assertVisible:
    id: 'email-input'
- assertVisible:
    id: 'message-label'
- assertVisible:
    id: 'message-input'
- assertVisible:
    id: 'submit-button'
- assertVisible:
    id: 'cancel-button'

# Close and repopen feedback widget
- tapOn:
    id: 'cancel-button'
- tapOn: 'Feedback'
- extendedWaitUntil:
    visible:
      id: 'sentry-logo'
    timeout: 1_000

# Fill out name field
- tapOn:
    id: 'name-input'
- inputText: 'John Doe'

# Fill out email field with a non valid email
- tapOn:
    id: 'email-input'
- inputText: 'test invalid email'

# Try to submit feedback and verify required field validation error
- hideKeyboard
- scrollUntilVisible:
    element:
      id: 'submit-button'
- tapOn:
    id: 'submit-button'
- assertVisible: 'Please fill out all required fields.'
- tapOn: 'OK'

# Fill out feedback form required message field
- tapOn:
    id: 'message-input'
- inputText: 'This is a test feedback message from CI e2e tests'

# Try to submit feedback and verify email validation error
- hideKeyboard
- scrollUntilVisible:
    element:
      id: 'submit-button'
- tapOn:
    id: 'submit-button'
- assertVisible: 'Please enter a valid email address.'
- tapOn: 'OK'

# Fill out email field with a valid email
- tapOn:
    id: 'email-input'
- eraseText
- inputText: 'test@email.com'

# Submit feedback
- hideKeyboard
- scrollUntilVisible:
    element:
      id: 'submit-button'
- tapOn:
    id: 'submit-button'
- assertVisible: 'Thank you for your report!'
- tapOn: 'OK'

# Verify feedback form is closed and the home screen is visible
- assertVisible: 'Welcome to React Native'
