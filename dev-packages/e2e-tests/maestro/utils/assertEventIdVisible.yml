appId: ${APP_ID}
jsEngine: graaljs
---
- extendedWaitUntil:
    visible:
      id: "eventId"
    timeout: 600_000 # 10 minutes

- copyTextFrom:
    id: "eventId"
- assertTrue: ${maestro.copiedText}

# Add a delay for iOS platform to ensure replays are available before the api call
- evalScript: |
    if (maestro.platform === "iOS") {
      maestro.sleep(10000);
    }
    true;

- runScript:
    file: sentryApi.js
    env:
      fetch: event
      id: ${maestro.copiedText}
      sentryAuthToken: ${SENTRY_AUTH_TOKEN}

- assertTrue: ${output.eventId == maestro.copiedText}
